<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½æ¨æ¼” BI å¤§å± (äº‘ç«¯ç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .header h2 { margin: 0; color: #1890ff; }
        .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .report-content { font-size: 15px; line-height: 1.6; }
        .report-content blockquote { border-left: 4px solid #1890ff; margin: 0; padding: 10px 15px; background: #e6f7ff; color: #0050b3; border-radius: 4px; font-weight: bold; }
        .report-content h1, .report-content h2, .report-content h3 { color: #2c3e50; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-top: 25px; }
        .chart-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .chart-box { height: 350px; background: #fafafa; border: 1px solid #f0f0f0; border-radius: 8px; padding: 10px; }
        .update-time { font-size: 14px; color: #888; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ“Š AI å…­åˆå½©æ¨æ¼” BI å¤§å±</h2>
        <span class="update-time" id="lastUpdateTime">æ­£åœ¨åŠ è½½æœ€æ–°äº‘ç«¯æ¨æ¼”æ•°æ®...</span>
    </div>

    <div class="card" id="reportCard">
        <div id="reportContent" class="report-content"></div>
        
        <h3 style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; color: #2c3e50;">ğŸ“ˆ äº¤äº’å¼æ•°æ®è§‚æµ‹ä»ªè¡¨ç›˜</h3>
        <div class="chart-grid">
            <div id="chartMiss" class="chart-box"></div>
            <div id="chartHot" class="chart-box"></div>
            <div id="chartZodiac" class="chart-box"></div>
            <div id="chartColor" class="chart-box"></div>
        </div>
    </div>
</div>

<script>
    window.onload = fetchReportAndCharts;

    async function fetchReportAndCharts() {
        try {
            // ç›´æ¥è¯»å–é™æ€ Markdown æŠ¥å‘Šæ–‡ä»¶ (åŠ æ—¶é—´æˆ³é˜²æ­¢æµè§ˆå™¨ç¼“å­˜)
            const reportResp = await fetch('lottery_analysis_report.md?t=' + new Date().getTime());
            if (reportResp.ok) {
                const markdownText = await reportResp.text();
                document.getElementById('reportContent').innerHTML = marked.parse(markdownText);
                document.getElementById('lastUpdateTime').innerText = "äº‘ç«¯æ•°æ®å·²åŒæ­¥ | é¡µé¢è‡ªåŠ¨æ›´æ–°äº " + new Date().toLocaleTimeString();
            }
            
            // ç›´æ¥è¯»å–é™æ€ ECharts å›¾è¡¨æ•°æ®æ–‡ä»¶
            const chartResp = await fetch('chart_data.json?t=' + new Date().getTime());
            if (chartResp.ok) {
                const chartData = await chartResp.json();
                renderCharts(chartData);
            }
        } catch (error) {
            document.getElementById('lastUpdateTime').innerText = "è¯»å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨ååˆ·æ–°é‡è¯•";
            console.log("å°šæ— ç”Ÿæˆçš„æ•°æ®æˆ–è¯·æ±‚å¤±è´¥", error);
        }
    }

    function renderCharts(data) {
        const chartMiss = echarts.init(document.getElementById('chartMiss'));
        const missKeys = Object.keys(data.miss_values).sort((a,b)=>a-b);
        const missVals = missKeys.map(k => data.miss_values[k]);
        chartMiss.setOption({
            title: { text: 'å½“å‰å„å·ç é—æ¼æœŸæ•°', left: 'center', textStyle: {fontSize: 14} },
            tooltip: { trigger: 'axis' },
            dataZoom: [{ type: 'inside' }, { type: 'slider', height: 15, bottom: 5 }],
            xAxis: { type: 'category', data: missKeys },
            yAxis: { type: 'value' },
            series: [{ data: missVals, type: 'bar', itemStyle: { color: '#1890ff' } }]
        });

        const chartHot = echarts.init(document.getElementById('chartHot'));
        const hotKeys = Object.keys(data.hot_cold).sort((a,b)=>a-b);
        const hotVals = hotKeys.map(k => data.hot_cold[k]);
        chartHot.setOption({
            title: { text: 'è¿‘50æœŸå¼€å‡ºé¢‘æ¬¡ (å†·çƒ­åˆ†æ)', left: 'center', textStyle: {fontSize: 14} },
            tooltip: { trigger: 'axis' },
            xAxis: { type: 'category', data: hotKeys },
            yAxis: { type: 'value' },
            series: [{ data: hotVals, type: 'line', smooth: true, areaStyle: {}, itemStyle: { color: '#52c41a' } }]
        });

        const chartZodiac = echarts.init(document.getElementById('chartZodiac'));
        const zodiacData = Object.keys(data.zodiac_counts).map(k => ({ name: k, value: data.zodiac_counts[k] }));
        chartZodiac.setOption({
            title: { text: 'å†å²ç‰¹ç ç”Ÿè‚–å æ¯”', left: 'center', textStyle: {fontSize: 14} },
            tooltip: { trigger: 'item' },
            series: [{ type: 'pie', radius: '50%', data: zodiacData, emphasis: { itemStyle: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)' } } }]
        });

        const chartColor = echarts.init(document.getElementById('chartColor'));
        const colorData = Object.keys(data.color_counts).map(k => {
            let c = k === 'çº¢' ? '#f5222d' : (k === 'è“' ? '#1890ff' : (k === 'ç»¿' ? '#52c41a' : '#999'));
            return { name: k + 'æ³¢', value: data.color_counts[k], itemStyle: { color: c } };
        });
        chartColor.setOption({
            title: { text: 'å†å²ç‰¹ç æ³¢è‰²å æ¯”', left: 'center', textStyle: {fontSize: 14} },
            tooltip: { trigger: 'item' },
            series: [{ type: 'pie', radius: ['40%', '70%'], data: colorData }]
        });
        
        window.addEventListener('resize', () => {
            chartMiss.resize(); chartHot.resize(); chartZodiac.resize(); chartColor.resize();
        });
    }
</script>

</body>
</html>