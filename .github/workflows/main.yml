name: ğŸš€ æ€çŒªç›˜çƒ­åŠ›ç›‘æ§æµæ°´çº¿

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 21:30 è‡ªåŠ¨æ‰§è¡Œ (UTCæ—¶é—´ 13:30)
    - cron: '30 13 * * *'
  workflow_dispatch: # å…è®¸ç½‘é¡µç«¯æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ

permissions:
  contents: write # èµ‹äºˆæœºå™¨äººå†™å…¥æ•°æ®åº“å’Œç”ŸæˆæŠ¥å‘Šçš„æƒé™

jobs:
  run-pipeline:
    runs-on: ubuntu-latest

    steps:
      - name: æ‹‰å–æœ€æ–°ä»£ç 
        uses: actions/checkout@v3

      - name: é…ç½® Python ç¯å¢ƒ (3.10)
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: å®‰è£…æ ¸å¿ƒä¾èµ–åº“
        run: |
          python -m pip install --upgrade pip
          # ç°åœ¨çš„ç®—æ³•æ˜¯çº¯æ•°å­¦é€»è¾‘ï¼Œä¸å†éœ€è¦ tensorflow/xgboost
          pip install requests pandas

      - name: æ‰§è¡Œæ•°æ®æŠ“å–ä¸åæ€æ¨æ¼”
        run: |
          # 1. æŠ“å–æœ€æ–°æ•°æ®
          python fetcher.py
          # 2. ç”Ÿæˆå›¾è¡¨æ•°æ®
          python analyzer.py
          # 3. è¿è¡Œèµ„é‡‘çƒ­åŠ›åæ¨ (ä½¿ç”¨Proç‰ˆ)
          python predictor_pro.py
          # 4. ç”ŸæˆæŠ¥å‘Šå¹¶æ¨é€ (å¦‚æœæœ‰main.pyä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œ python main.py)
          # è¿™é‡Œä¸ºäº†ä¿é™©ï¼Œç›´æ¥è¿è¡Œä¸»æ§ç¨‹åº
          python main.py

      - name: æäº¤å¹¶æ¨é€æœ€æ–°æ•°æ®
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Bot"
          git add .
          git commit -m "ğŸ“Š Auto-update: èµ„é‡‘çƒ­åŠ›ç›²åŒºæŠ¥å‘Šæ›´æ–°" || echo "No changes to commit"
          # å…³é”®ï¼šå…ˆæ‹‰å–è¿œç¨‹æœ€æ–°ä»£ç ï¼Œé˜²æ­¢å†²çªï¼Œç„¶åå†æ¨
          git pull --rebase origin main
          git push
